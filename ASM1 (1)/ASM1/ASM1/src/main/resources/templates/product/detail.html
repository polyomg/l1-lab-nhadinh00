<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Product Detail</title>
	<style>
	    body {
	        background: no-repeat center center fixed;
	        background-size: cover;
	        min-height: 100vh;
	        display: flex;
	        align-items: center;
	        justify-content: center;
	        font-family: 'Poppins', sans-serif;
	        overflow: hidden;
	        transition: background 0.5s ease-in-out;
	        background-color: #ffeef5; /* pastel hồng nhẹ */
	    }

	    .container {
	        background: rgba(255, 182, 193, 0.25); /* hồng pastel mờ */
	        backdrop-filter: blur(12px);
	        padding: 40px;
	        border-radius: 25px;
	        box-shadow: 0 8px 20px rgba(255, 105, 180, 0.2);
	        width: 85%;
	        max-width: 1600px;
	        display: flex;
	        flex-direction: column;
	        transition: opacity 0.8s ease-in-out;
	    }

	    .product-detail-container {
	        display: flex;
	        flex-direction: row;
	        gap: 40px;
	    }

	    .product-image {
	        flex: 1;
	        display: flex;
	        justify-content: center;
	        align-items: center;
	    }

	    .product-image img {
	        max-width: 100%;
	        max-height: 600px;
	        border-radius: 20px;
	        box-shadow: 0 6px 15px rgba(255, 105, 180, 0.25);
	    }

	    .product-info {
	        flex: 1;
	        display: flex;
	        flex-direction: column;
	        justify-content: center;
	    }

	    .product-info h2 {
	        font-size: 54px;
	        color: #d63384; /* hồng đậm pastel */
	        margin-bottom: 20px;
	        font-weight: 700;
	    }

	    .product-info p {
	        font-size: 26px;
	        color: #444;
	        margin-bottom: 18px;
	    }

	    .product-info button {
	        padding: 14px 28px;
	        font-size: 20px;
	        background: linear-gradient(135deg, #ffb6c1, #ff99cc);
	        color: white;
	        border: none;
	        border-radius: 15px;
	        cursor: pointer;
	        margin-bottom: 20px;
	        transition: 0.3s ease;
	        box-shadow: 0 4px 10px rgba(255, 105, 180, 0.3);
	    }

	    .product-info button:hover {
	        background: linear-gradient(135deg, #ff99cc, #ff80b5);
	        transform: translateY(-2px);
	    }

	    .product-detail {
	        font-size: 18px;
	        color: #555;
	        line-height: 1.8;
	        background: #fff0f5;
	        padding: 15px;
	        border-radius: 12px;
	        box-shadow: inset 0 2px 6px rgba(255, 182, 193, 0.3);
	    }

	    /* Modal CSS */
	    .modal {
	        display: none;
	        position: fixed;
	        top: 0;
	        left: 0;
	        width: 100%;
	        height: 100%;
	        background-color: rgba(255, 182, 193, 0.4);
	        justify-content: center;
	        align-items: center;
	        z-index: 1000;
	    }

	    .modal-content {
	        background: #fff0f5;
	        padding: 25px;
	        border-radius: 15px;
	        box-shadow: 0 6px 18px rgba(255, 105, 180, 0.3);
	        text-align: center;
	        width: 340px;
	        position: relative;
	    }

	    .close-button {
	        position: absolute;
	        top: 12px;
	        right: 15px;
	        font-size: 24px;
	        cursor: pointer;
	        color: #d63384;
	    }

	    .close-button:hover {
	        color: #ff4da6;
	    }

	    .close-modal-button {
	        background: linear-gradient(135deg, #ff99cc, #ff80b5);
	        color: white;
	        border: none;
	        padding: 12px 24px;
	        border-radius: 10px;
	        cursor: pointer;
	        margin-top: 20px;
	        font-size: 16px;
	        box-shadow: 0 4px 10px rgba(255, 105, 180, 0.3);
	        transition: 0.3s ease;
	    }

	    .close-modal-button:hover {
	        background: linear-gradient(135deg, #ff80b5, #ff6699);
	        transform: scale(1.05);
	    }
	</style>

</head>
<body th:style="'background-image: url(' + ${product.hinhNenSP} + ');'">

    <div class="container">
        <!-- Thêm phần header giống như list.html -->
        <div th:replace="fragments/header :: header"></div>

        <!-- Phần chi tiết sản phẩm -->
        <div class="product-detail-container">
            <div class="product-image">
                <img th:src="${product.hinhSP}" th:alt="${product.tenSP}" />
            </div>
            <div class="product-info">
                <h2 th:text="${product.tenSP}"></h2>
                <p th:text="'Giá: ' + ${product.giaSP} + ' VND'"></p>
                <p th:text="'Số lượng còn lại: ' + ${product.soLuong}"></p>
                <form th:action="@{/add-to-cart}" method="post" class="add-to-cart-form">
                    <input type="hidden" name="maKH" th:value="${currentCustomer?.maKH}" />
                    <input type="hidden" name="maSP" th:value="${product.maSP}" />
                    <input type="hidden" name="tenSP" th:value="${product.tenSP}" />
                    <input type="hidden" name="hinhSP" th:value="${product.hinhSP}" />
                    <input type="hidden" name="soLuong" value="1" min="1" th:max="${product.soLuong}" />
                    <input type="hidden" name="giaSP" th:value="${product.giaSP}" />
                    <button type="submit">Add to Cart</button>
                </form>
                <div class="product-detail" th:text="${product.chiTietSP}"></div>
            </div>
        </div>
    </div>

    <!-- Modal thông báo -->
    <div id="notificationModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <p id="modalMessage"></p>
            <button class="close-modal-button">Đóng</button>
        </div>
    </div>

    <script src="https://unpkg.com/@dotlottie/player-component@2.7.12/dist/dotlottie-player.mjs" type="module"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function () {
        // Xử lý modal thông báo
        const modal = document.getElementById("notificationModal");
        const modalMessage = document.getElementById("modalMessage");
        const closeButton = document.querySelector(".close-button");
        const closeModalButton = document.querySelector(".close-modal-button");

        function showModal(message) {
            modalMessage.textContent = message;
            modal.style.display = "flex";
        }

        function hideModal() {
            modal.style.display = "none";
        }

        closeButton.addEventListener("click", hideModal);
        closeModalButton.addEventListener("click", hideModal);

        window.addEventListener("click", function (event) {
            if (event.target === modal) {
                hideModal();
            }
        });

        // Kiểm tra nếu có thông báo từ server, hiển thị modal
        const message = "[[${message}]]";
        if (message) {
            showModal(message);
        }

        // Xử lý thêm sản phẩm vào giỏ hàng
        const addToCartForms = document.querySelectorAll(".add-to-cart-form");
        addToCartForms.forEach((form) => {
            form.addEventListener("submit", function (event) {
                event.preventDefault();

                const formData = new FormData(form);
                const maKH = formData.get("maKH");

                if (!maKH) {
                    showModal("Vui lòng đăng nhập để thêm sản phẩm vào giỏ hàng.");
                    return;
                }

                fetch(form.action, {
                    method: "POST",
                    body: formData,
                })
                    .then((response) => {
                        if (response.ok) {
                            showModal("Sản phẩm đã được thêm vào giỏ hàng thành công!");
                            // Không chuyển hướng đến giỏ hàng
                        } else {
                            showModal("Có lỗi xảy ra khi thêm sản phẩm vào giỏ hàng.");
                        }
                    })
                    .catch((error) => {
                        console.error("Error:", error);
                        showModal("Có lỗi xảy ra khi thêm sản phẩm vào giỏ hàng.");
                    });
            });
        });
    });
    </script>
</body>
</html>